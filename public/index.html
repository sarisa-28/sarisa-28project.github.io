<!--public/index.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: url('https://i.pinimg.com/736x/55/62/1e/55621e8eb3b28264c1f1684c9e3250b1.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .login-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px cyan;
            width: 100%;
            max-width: 400px;
        }
        .login-container h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 30px;
            color: orangered;
            text-shadow: 3px 3px 6px cyan;
            
        }
        .form-group {
            margin-bottom: 8px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        .form-group input {
            width: 95%;
            padding: 10px;
            border: 1px solid #ddd;
            color: #000;
            border-radius: 4px;
        }
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .btn {
            width: 100%;
            padding: 10px;
            background: #007BFF;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover {
            background: #0056b3;
        }
        .link {
            display: block;
            text-align: center;
            margin-top: 10px;
            color: #007BFF;
            text-decoration: none;
        }
        .link:hover {
            text-decoration: underline;
        }
        /* QR Code ‡πÑ‡∏ß‡πâ‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
        .qr-container {
            position: absolute;
            top: 10px;
            left: 10px;
            text-align: center;
        }
        .qr-container h2 {
            font-size: 18px;
            color:darkorange;
        }
        .qr-container img {
            width: 100px;
            height: auto;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px cyan;
        }
        .form-link {
    background: linear-gradient(45deg, rgb(238, 107, 19), #4aa44f);
    border: none;
    color: black;
    padding: 12px 24px;
    font-size: 18px;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    margin-top: 15px;
    width: 80%;
    box-shadow: 0 0 15px cyan;
}

.form-link:hover {
    transform: scale(1.1);
}
.login-container h3{
    color: darkblue;
}
.meteor {
    position: absolute;
    top: -10px;
    background-color: rgba(255, 255, 255, 0.8);
    border-radius: 50%;
    animation: meteor-shower 5s linear infinite;
    background-color: rgb(225, 85, 246);
}
    </style>
</head>
<body>

    <!-- QR Code ‡πÑ‡∏ß‡πâ‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ -->
    <div class="qr-container">
        <h2>üëáüèº ‡πÅ‡∏™‡∏Å‡∏ôQRcode üëáüèº</h2>
        <img src="image/QRcode.png" alt="QR Code">
        <h2>‚ù§Ô∏è‚Äçüî• ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡πà‡∏π‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå üì≤</h2>
        <p><h2> ‡∏´‡∏£‡∏∑‡∏≠ </h2></p>
        <a href="https://www.canva.com/design/DAGev--m8So/dOhvxPSigvaOzJyk9vEclQ/edit?utm_content=DAGev--m8So&utm_campaign=designshare&utm_medium=link2&utm_source=sharebutton" target="_blank" class="form-link">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
    </div>
    
    <div class="login-container">
        <h2>Welcome To</h2>
        <h3>Website for Evaluating Programming and Algorithmic Expertise Using C++</h3>
        <h2>üåè Login üóæ</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="loginType">Login as:</label>
                <select id="loginType" required>
                    <option value="Player">Player</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" placeholder="Enter your username" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>
            <button type="button" class="btn" id="login" onclick="handleLogin()">Login</button>
        </form>
        <a href="#" class="link" onclick="showRegisterForm()">Create Account</a>
        <a href="#" class="link" onclick="showResetPasswordForm()">Forgot Password?</a>
    </div>

    <div class="login-container" id="registerForm" style="display: none;">
        <h2>ü™™ Register üåê</h2>
        <form>
            <div class="form-group">
                <label for="registerType">Register as:</label>
                <select id="registerType" required>
                    <option value="Player">Player</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label for="registerUsername">Username:</label>
                <input type="text" id="registerUsername" placeholder="Enter your username" required>
            </div>
            <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå Gmail ‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å -->
            <div class="form-group">
                <label for="registerEmail">Email (Gmail):</label>
                <input type="email" id="registerEmail" placeholder="Enter your Gmail" required>
            </div>

            <div class="form-group">
                <label for="registerPassword">Password:</label>
                <input type="password" id="registerPassword" placeholder="Enter your password" required>
            </div>
            <button type="button" class="btn" id="register" onclick="handleRegister()">Register</button>
        </form>
        <a href="#" class="link" onclick="showLoginForm()">Back to Login</a>
    </div>

    <div class="login-container" id="resetPasswordForm" style="display: none;">
        <h2>ü§® Forgot Password ü§î</h2>
        <form>
            <div class="form-group">
                <label for="resetType">Reset as:</label>
                <select id="resetType" required>
                    <option value="Player">Player</option>
                    <option value="Admin">Admin</option>
                </select>
            </div>
            <div class="form-group">
                <label for="resetUsername">Username:</label>
                <input type="text" id="resetUsername" placeholder="Enter your username" required>
            </div>
            <div class="form-group">
                <label for="resetEmail">Email:</label>  
                <input type="email" id="resetEmail" placeholder="Enter your email" required>
            </div>            
          <p><button type="button" class="btn" id="otp" onclick="sendOTP()">Send OTP</button></p>            
            
          <div class="form-group" id="resetPasswordBtn" style="display: none;">
                <label for="otpCode">OTP:</label>
                <input type="text" id="otpCode" placeholder="Enter OTP sent to your Gmail" required>
            </div>  
            <div class="form-group" id="newPasswordGroup" style="display: none;">
                <label for="newPassword">New Password:</label>
                <input type="password" id="newPassword" placeholder="Enter new password" required>
            </div>
                <button type="button" class="btn" id="reset" onclick="handlePasswordReset()">Reset Password</button>

        <a href="#" class="link" onclick="showLoginForm()">Back to Login</a>
    </div>
    
    <audio id="o-sound" src="sounds/o.mp3" preload="auto"></audio>
    <audio id="background-music" src="sounds/index.mp3" autoplay loop></audio>

    <script>
    const API_BASE_URL = "http://localhost:3000";

    
    async function handleLogin() {
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const loginType = document.getElementById('loginType').value;  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ loginType
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ loginType ‡πÉ‡∏ô localStorage
        localStorage.setItem("loginType", loginType.toLowerCase()); 

    if (!username || !password) {
        alert('Please fill in all fields.');
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password, type: loginType })
        });

        if (response.ok) {
            const data = await response.json();
            // ‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô sessionStorage
            sessionStorage.setItem('username', username);
            alert(`${data.type} login successful!`);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö loginType ‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
            if (loginType === 'Admin') {
                window.location.href = "start.html";  // ‡∏ñ‡πâ‡∏≤ login ‡πÄ‡∏õ‡πá‡∏ô Admin ‡πÑ‡∏õ‡∏¢‡∏±‡∏á start.html
            } else if (loginType === 'Player') {
                window.location.href = "play.html";  // ‡∏ñ‡πâ‡∏≤ login ‡πÄ‡∏õ‡πá‡∏ô Player ‡πÑ‡∏õ‡∏¢‡∏±‡∏á play.html
            }
        } else {
            alert('Invalid credentials');
        }
    } catch (error) {
        console.error('Error during login:', error);
        alert('An error occurred during login. Please try again.');
    }
}

async function handleRegister() {
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;
    const type = document.getElementById('registerType').value;
    const email = document.getElementById('registerEmail').value;  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå email

    if (!username || !password || !email) {  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô
        alert('Please fill in all fields.');
        return;
    }

    try {
        const response = await fetch(`http://localhost:3000/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password, type, email }),  // ‡∏™‡πà‡∏á email ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
        });

        if (response.ok) {
            alert('Registration successful! You can now log in.');
            showLoginForm();
        } else {
            const errorText = await response.text();
            alert(`Registration failed: ${errorText}`);
        }
    } catch (error) {
        console.error('Error during registration:', error);
        alert('An error occurred during registration. Please try again.');
    }
}
    
async function handlePasswordReset() {
    const type = document.getElementById('resetType').value;  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ type            
    const username = document.getElementById('resetUsername').value;
    const email = document.getElementById('resetEmail').value
    const otpCode = document.getElementById('otpCode').value;
    const newPassword = document.getElementById('newPassword').value;

    if (!username || !newPassword || !email || !otpCode || !type) {
        alert('Please fill in all fields: type, username, oldPassword, newPassword, and OTP.');
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/reset-password2`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ type, username, newPassword,email, otpCode }),
        });

        if (response.ok) {
            alert('Password reset successful!');
            showLoginForm();
        } else {
            const errorText = await response.text();
            alert(`Failed to reset password: ${errorText}`);
        }
    } catch (error) {
        console.error('Error during password reset:', error);
        alert('An error occurred during password reset. Please try again.');
    }
}

async function sendOTP() {
    const email = document.getElementById('resetEmail').value;  // ‡∏£‡∏±‡∏ö email ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    const username = document.getElementById('resetUsername').value;  // ‡∏£‡∏±‡∏ö username ‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
    const type = document.getElementById('resetType').value;  // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ type

    if (!email || !username || !type) {
        alert('Please enter your email and username to receive the OTP.');
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/send-otp`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, username, type }),  // ‡∏™‡πà‡∏á email ‡πÅ‡∏•‡∏∞ username ‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
        });

        if (response.ok) {
            alert('OTP has been sent to your email.');
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å OTP ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á
            document.getElementById('newPasswordGroup').style.display = 'block';
            document.getElementById('resetPasswordBtn').style.display = 'block';
        } else {
            const errorText = await response.text();
            alert(`Failed to send OTP: ${errorText}`);
        }
    } catch (error) {
        console.error('Error during OTP sending:', error);
        alert('An error occurred while sending OTP. Please try again.');
    }
}

        function showRegisterForm() {
    document.getElementById('registerForm').style.display = 'block';
    document.getElementById('loginForm').parentNode.style.display = 'none';
    document.getElementById('resetPasswordForm').style.display = 'none';
}

function showLoginForm() {
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').parentNode.style.display = 'block';
    document.getElementById('resetPasswordForm').style.display = 'none';
}

function showResetPasswordForm() {
    document.getElementById('registerForm').style.display = 'none';
    document.getElementById('loginForm').parentNode.style.display = 'none';
    document.getElementById('resetPasswordForm').style.display = 'block';
}

// ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏õ‡∏∏‡πà‡∏°
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå
    function playSound(sound) {
        sound.pause();        // ‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        sound.currentTime = 0; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏õ‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        sound.play();         // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    }

const oSound = document.getElementById("o-sound");

//‡πÄ‡∏™‡∏µ‡∏¢‡∏á
document.getElementById("login").addEventListener("click", () => playSound(oSound));
document.getElementById("register").addEventListener("click", () => playSound(oSound));
document.getElementById("otp").addEventListener("click", () => playSound(oSound));
document.getElementById("reset").addEventListener("click", () => playSound(oSound));
document.addEventListener("DOMContentLoaded", function() {
    const music = document.getElementById("background-music");

    // ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö (‡∏ñ‡πâ‡∏≤‡∏ö‡∏£‡∏≤‡∏ß‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏ö‡∏•‡πá‡∏≠‡∏Å)
    music.play().catch(error => {
        console.warn("Autoplay ‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ...");
    });

    // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏î‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏ï‡πâ‡∏ï‡∏≠‡∏ö‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    document.addEventListener("click", function() {
        if (music.paused) {
            music.play();
        }
    });
});


// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏≤‡∏ß‡∏ï‡∏Å‡πÉ‡∏´‡∏°‡πà
function createMeteor() {
    const meteor = document.createElement('div');
    meteor.classList.add('meteor');
    document.body.appendChild(meteor);
    
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏î‡∏≤‡∏ß
    meteor.style.left = `${Math.random() * 100}vw`;
    meteor.style.animationDuration = `${Math.random() * 5 + 5}s`;  // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏Å‡∏ä‡πâ‡∏≤‡πÜ

    // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏î‡∏≤‡∏ß‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô
    meteor.style.width = `${Math.random() * 3 + 4}px`;
    meteor.style.height = `${Math.random() * 3 + 4}px`;
    meteor.style.opacity = Math.random() * 0.5 + 0.5;

    // ‡∏•‡∏ö‡∏î‡∏≤‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏™‡∏£‡πá‡∏à
    setTimeout(() => {
        meteor.remove();
    }, (Math.random() * 5 + 5) * 1000);  // ‡∏•‡∏ö‡∏î‡∏≤‡∏ß‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏≠‡∏á animation
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡∏≤‡∏ß‡∏ï‡∏Å‡∏ó‡∏∏‡∏Å‡πÜ 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
setInterval(createMeteor, 500);

    </script>    
</body>
</html>